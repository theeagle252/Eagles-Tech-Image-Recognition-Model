<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Eagles Workshop Tool Classifier</title>
<script src="https://cdn.roboflow.com/0.2.26/roboflow.js"></script>
<style>
body {
    font-family: Arial, sans-serif;
    background-color: #a3d5ff;
    color: black;
    text-align: center;
    margin: 0;
    padding: 0;
    overflow-x: hidden;
    position: relative;
}

/* Floating tools */
.floating-tool {
    position: absolute;
    width: 120px;
    pointer-events: none;
    z-index: 1;
    animation: floatTool linear infinite;
}
@keyframes floatTool {
    0% { transform: translateY(-150px); opacity: 0.3; }
    50% { opacity: 0.9; }
    100% { transform: translateY(110vh); opacity: 0.3; }
}

header {
    background-color: #004080;
    color: white;
    padding: 20px 0;
    position: relative;
    z-index: 2;
}
header img { width: 80px; vertical-align: middle; }
header h1 { display: inline; margin-left: 15px; font-size: 28px; vertical-align: middle; }

.container {
    margin: 20px auto;
    width: 90%;
    max-width: 800px;
    background-color: rgba(255,255,255,0.7);
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 0 15px rgba(0,0,0,0.2);
    position: relative;
    z-index: 2;
}

input, button {
    padding: 10px;
    margin: 10px;
    border-radius: 6px;
    border: none;
    font-size: 16px;
}
input { width: 70%; }
button {
    background-color: #0055cc;
    color: white;
    cursor: pointer;
}
button:hover { background-color: #003399; }

#startCam { background-color: green; }
#stopCam { background-color: red; }

#output img {
    max-width: 100%;
    margin-top: 15px;
    border-radius: 8px;
    border: 2px solid #0055cc;
}

video {
    border: 2px solid #0055cc;
    border-radius: 8px;
    margin-top: 10px;
}

footer {
    margin-top: 30px;
    padding: 15px;
    background: #002244;
    font-size: 14px;
    color: #ddd;
    position: relative;
    z-index: 2;
}
.footer-contact {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 15px;
}
.footer-contact a {
    color: #ddd;
    text-decoration: none;
    display: flex;
    align-items: center;
    gap: 5px;
}
.footer-note {
    color: red;
    margin-top: 5px;
}
</style>
</head>
<body>

<header>
    <img src="logo.png" alt="Eagle Logo">
    <h1>Eagles Workshop Hand Tools Classifier</h1>
</header>

<div class="container">
    <h2>Upload Image</h2>
    <input type="file" id="fileInput" accept="image/*">
    <button onclick="predictFile()">Predict</button>

    <h2>Or Enter Image URL</h2>
    <input type="text" id="urlInput" placeholder="https://example.com/image.jpg">
    <button onclick="predictURL()">Predict</button>

    <h2>Use Webcam</h2>
    <div>
        <button id="startCam" onclick="startCamera()">Start Camera</button>
        <button id="stopCam" onclick="stopCamera()">Stop Camera</button>
        <button onclick="captureWebcam()">üì∏ Capture & Predict</button>
    </div>
    <video id="webcam" autoplay playsinline width="400" style="display:none;"></video>

    <div id="output"></div>
</div>

<footer>
    üôè Thanks for using Eagles Workshop hand tools image prediction<br>
    <div class="footer-contact">
        <a href="https://wa.me/07017844963" target="_blank">
            <img src="https://cdn-icons-png.flaticon.com/512/733/733585.png" width="18" height="18" alt="WhatsApp"> 07017844963
        </a>
        <a href="mailto:adokuodesweet252@gmail.com">
            <img src="https://cdn-icons-png.flaticon.com/512/732/732200.png" width="18" height="18" alt="Gmail"> adokuodesweet252@gmail.com
        </a>
    </div>
    <div class="footer-note">
        NOTE: This model may make mistakes as it is still under development. Please feel free to contact us if you notice any issues or improvements that could be made.
    </div>
</footer>

<script>
const publishable_key = "rf_gqfgFH1WMfRj1jN9oJQF5KuWINm1"; 
const model = "tools-9wzx8-njnxh"; 
const version = 1;
let roboflowModel;
let stream;

// ‚úÖ Tool images
const tools = [
  "https://th.bing.com/th/id/OIP.84Ljl-aEQC1b8fefMwajqwHaFM?w=246&h=180&c=7&r=0&o=7&pid=1.7&rm=3",
  "https://th.bing.com/th/id/OIP.46er6CZtYiWiT-zTxA_BMwHaEW?w=294&h=180&c=7&r=0&o=7&pid=1.7&rm=3",
  "https://www.bing.com/th/id/OIP.opGWCVUVaBqIZ__I1az5XwHaF9?w=228&h=211&c=8&rs=1&qlt=90&o=6&pid=3.1&rm=2",
  "https://www.bing.com/th/id/OIP.EUo_XimOC61dCinDoKB7owHaE6?w=238&h=211&c=8&rs=1&qlt=90&o=6&pid=3.1&rm=2",
  "https://www.bing.com/th/id/OIP.O5Rgl6Y8Xi9K0kY3Il42fQHaFW?w=260&h=211&c=8&rs=1&qlt=90&o=6&pid=3.1&rm=2",
  "https://www.bing.com/th/id/OIP.T9-pK0U3gl3JbFEghYQIzAHaGE?w=226&h=211&c=8&rs=1&qlt=90&o=6&rm=2",
  "https://www.bing.com/th/id/OIP.S-LzbKBBNYKJ_wh685sf9QHaF7?w=233&h=211&c=8&rs=1&qlt=90&o=6&rm=2",
  "https://cdn-icons-png.flaticon.com/512/2913/2913465.png" // lathe machine placeholder
];

function createFloatingTools() {
    let delay = 0;
    tools.forEach((src) => {
        const img = document.createElement("img");
        img.src = src;
        img.className = "floating-tool";
        img.style.left = `${Math.random()*90}vw`;
        img.style.top = `-${Math.random()*200}px`;
        img.style.animationDuration = "25s";
        img.style.animationDelay = `${delay}s`; // staggered start
        delay += 3;
        document.body.appendChild(img);
    });
}
createFloatingTools();

// Load Roboflow model
roboflow.auth({ publishable_key }).load({ model, version }).then(m => {
    roboflowModel = m;
    console.log("Model loaded ‚úÖ");
});

// Display prediction result
function displayResult(predictions, imageSrc) {
    const outputDiv = document.getElementById("output");
    outputDiv.innerHTML = "";
    const img = document.createElement("img");
    img.src = imageSrc;
    outputDiv.appendChild(img);

    let label = "‚ö†Ô∏è No class found";
    if (predictions.predicted_classes && predictions.predicted_classes.length > 0) {
        const confidence = predictions.predictions?.[predictions.predicted_classes[0]]?.confidence || 0;
        if (confidence >= 0.45) label = predictions.predicted_classes[0];
    }

    const p = document.createElement("p");
    p.innerText = `Image detected - ${label}\nüôè Thanks for using Eagles Workshop hand tools image prediction`;
    outputDiv.appendChild(p);
}

// Predict from file
async function predictFile() {
    if (!fileInput.files[0]) return alert("Please upload a file.");
    const file = fileInput.files[0];
    try {
        const predictions = await roboflowModel.detect(file);
        displayResult(predictions, URL.createObjectURL(file));
    } catch (err) { 
        console.error("Prediction failed for file:", err);
        alert("Prediction failed for local file. Make sure the file is an image."); 
    }
}

// Predict from URL
async function predictURL() {
    const url = document.getElementById("urlInput").value;
    if (!url) return alert("Please enter an image URL.");
    try {
        const predictions = await roboflowModel.detect(url);
        displayResult(predictions, url);
    } catch (err) {
        console.error("Prediction failed for URL:", err);
        alert("Prediction failed for URL. Make sure it is a direct image link.");
    }
}

// Webcam
async function startCamera() {
    try {
        stream = await navigator.mediaDevices.getUserMedia({ video: true });
        const video = document.getElementById("webcam");
        video.srcObject = stream;
        video.style.display = "block";
    } catch (err) { console.error("Cannot access webcam:", err); }
}

function stopCamera() {
    if (stream) {
        stream.getTracks().forEach(track => track.stop());
        document.getElementById("webcam").style.display = "none";
    }
}

async function captureWebcam() {
    const video = document.getElementById("webcam");
    if (video.style.display === "none") return alert("Please start the camera first.");
    const canvas = document.createElement("canvas");
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    const ctx = canvas.getContext("2d");
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

    canvas.toBlob(async (blob) => {
        try {
            const predictions = await roboflowModel.detect(blob);
            const dataUrl = canvas.toDataURL("image/jpeg");
            displayResult(predictions, dataUrl);
        } catch (err) {
            console.error("Prediction failed for webcam:", err);
            alert("Prediction failed for webcam.");
        }
    }, "image/jpeg");
}
</script>

</body>
</html>
